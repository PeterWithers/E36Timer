/*
 * Copyright (C) 2016 Peter Withers
 */
package com.bambooradical.e36monitor;

import android.content.Context;
import android.net.wifi.WifiConfiguration;
import android.net.wifi.WifiInfo;
import android.net.wifi.WifiManager;
import android.os.Bundle;
import android.os.Handler;
import android.support.design.widget.FloatingActionButton;
import android.support.design.widget.Snackbar;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.webkit.WebView;

import org.json.JSONArray;
import org.json.JSONObject;

import java.io.BufferedInputStream;
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.List;
import java.util.Random;

/**
 * @since March 24, 2016 21:51:11 PM (creation date)
 * @author : Peter Withers <peter@gthb-bambooradical.com>
 */
public class MainActivity extends AppCompatActivity {

    boolean connectedToTimer = false;
    FloatingActionButton connectionButton;
    WebView myWebView;
    Handler connectionCheckHandler = new Handler();
    Runnable connectionCheckRunnable = new Runnable() {

        @Override
        public void run() {
            WifiManager wifiManager = (WifiManager) getApplicationContext().getSystemService(Context.WIFI_SERVICE);
            WifiInfo wifiInfo = wifiManager.getConnectionInfo();
            if (wifiInfo.getSSID() == null || !wifiInfo.getSSID().equals("\"E36 Timer\"")) {
                //connectionButton.setEnabled(true);
                if (connectedToTimer) {
                    myWebView.loadUrl("file:///android_asset/html/index.html");
                    connectedToTimer = false;
                }
            } else //connectionButton.setEnabled(false);
            if (!connectedToTimer) {
                myWebView.loadUrl("http://192.168.1.1/telemetry");
                connectedToTimer = true;
            }
            connectionCheckHandler.postDelayed(this, 500);
        }
    };

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        myWebView = (WebView) findViewById(R.id.webview);
        myWebView.getSettings().setJavaScriptEnabled(true);
        final FloatingActionButton addFlightTest = (FloatingActionButton) findViewById(R.id.addFlightTest);
        addFlightTest.setEnabled(false);
        addFlightTest.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                // startload json from the timer
                    String testJsonData = "{historyIndex: 441; "
                            + "altitudeHistory: [0.00, 0.16, -0.16, -1.39, 0.33, 0.41, 0.00, 43.16, -0.16, -0.33, 0.16, 0.00, -0.74, 0.08, 0.16, 0.41, -1.31, 0.49,"
                            + " -0.41, -0.25, -0.74, -0.16, 0.25, -0.49, 28.81, 0.16, -0.08, -0.08, -0.16, -1.06, -0.49, -0.16, 0.16, -0.65, 0.00, 0.25, -0.16, 0.57,"
                            + " 0.16, 0.41, 0.41, 0.25, 0.16, 0.41, 0.57, 0.65, -0.65, 0.16, 0.00, -0.57, -0.82, -0.08, -0.08, -0.16, -0.25, -0.08, 0.49, -0.08, -0.49,"
                            + " -0.98, 0.41, -0.98, 0.16, -1.23, 0.33, -0.65, -0.41, -0.98, -0.08, -0.16, 0.16, 21.11, 0.08, 0.00, 0.16, -0.41, -0.57, 0.00, 0.08, 0.00,"
                            + " -1.14, 0.16, -0.49, -0.25, -1.31, 0.25, -0.16, 0.65, 25.69, -0.16, 0.25, -0.16, 0.82, -0.57, -0.16, 0.16, 0.25, 0.08, 0.57, -0.08, 0.25,"
                            + " 0.41, 0.16, 0.25, 0.41, 31.67, -0.33, 0.00, 0.33, -0.41, -0.74, -0.08, -0.08, 0.41, -0.74, 0.16, 0.49, -0.16, -1.06, 0.08, 0.16, -0.65, "
                            + "30.77, -0.98, 0.65, -0.08, -0.16, -0.74, 0.16, -0.41, -0.16, -6.54, -0.25, 0.08, -0.33, 20.12, -0.08, -0.41, -0.33, -0.16, -0.90, 0.25, "
                            + "-0.08, -0.08, -0.98, 0.65, 0.16, 0.08, -1.06, -0.65, -0.49, 0.25, 0.08, 0.41, -0.41, -0.98, 0.16, -0.74, 0.16, -0.25, -0.33, -1.14, -0.41,"
                            + " -0.16, -0.41, -0.65, 0.16, -0.25, 0.25, 30.69, -0.33, -0.08, -0.25, -0.16, -1.39, -0.49, -0.49, -0.49, -0.74, 0.33, -0.49, -0.33, -0.25,"
                            + " -0.41, 0.00, -0.08, -0.08, -1.14, -0.25, 0.16, 0.00, -0.49, -0.16, -0.33, -0.16, -0.65, -0.33, -0.98, -0.33, 29.05, -0.65, 0.33, 0.25, "
                            + "0.00, 0.00, 0.00, 0.00, 0.00, -0.25, -0.49, -0.33, -0.25, -1.80, 0.08, 0.16, 0.00, 16.03, 0.16, 0.57, 0.00, -0.16, -0.98, -0.08, -0.08, "
                            + "0.33, -0.90, -0.41, -0.65, -0.16, -1.31, -0.16, -0.08, -0.25, 18.65, 0.00, -0.49, -0.74, -0.16, -1.14, -0.33, -0.33, -0.33, -0.98, -0.08,"
                            + " 0.00, -0.16, -0.25, -0.16, -0.25, -0.49, -0.25, -0.49, -0.65, -0.49, -0.08, -1.06, -0.33, 0.08, -0.16, -0.90, -0.16, -0.25, -0.16, 0.00,"
                            + " -0.41, -0.08, -0.25, -0.90, -1.47, -0.82, -0.49, -0.25, -0.90, -0.49, -0.49, -0.41, -1.55, -0.57, -0.25, -0.49, 26.51, -0.49, -0.74,"
                            + " -0.25, -0.33, -1.31, -0.25, -0.90, -0.25, -1.39, -0.74, -0.65, -0.65, -0.49, -0.33, -0.49, -0.49, -0.49, -0.08, -0.57, 0.00, -0.25,"
                            + " -0.90, -0.82, -0.65, -0.90, -1.06, -0.57, -0.16, -0.25, -0.74, 0.41, -0.57, -0.49, 0.33, -0.49, -0.98, -0.57, -0.16, -1.39, -1.14, -0.49,"
                            + " -0.82, -1.47, -0.33, -1.47, -0.82, -0.82, -0.41, -0.98, -1.06, -0.65, -1.72, -0.65, -0.82, -0.74, -1.14, -0.49, 13.74, -0.82, -1.55,"
                            + " -0.49, -0.65, -0.49, 26.76, -0.57, -0.74, -0.49, -0.65, -1.39, -1.14, -0.65, -0.82, -1.72, -1.14, -0.74, -0.41, -0.41, -0.08, -0.82,"
                            + " -0.57, -0.49, -0.74, -0.41, -0.49, -0.57, -1.23, -0.08, -0.41, -0.08, -1.14, -0.49, -0.33, -0.33, -0.41, -0.41, -0.41, -0.49, -0.65,"
                            + " -0.16, -0.49, -0.90, -0.74, -1.47, -0.98, -0.98, -0.41, -1.72, -0.49, -0.49, -1.06, 12.92, -0.90, -0.74, -0.90, -0.49, -1.47, -0.82, "
                            + "-0.49, -0.25, -1.14, -1.31, -0.25, -0.74, -1.31, -0.57, -1.23, -1.06, 26.76, -0.33, -0.74, -0.65, -0.49, -0.98, -1.06, -0.49, -0.74, "
                            + "-1.06, -0.57, -0.57, -0.57, -1.39, -0.65, -0.49, -0.49, 27.00, -0.49, -0.57, -0.82, -0.41, -1.14, -0.74, -0.65, -0.74, -1.55, -0.65, "
                            + "-0.90, -1.23, -0.16, -0.65, -0.98, -0.49, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, "
                            + "0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, "
                            + "0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, "
                            + "0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, ];"
                            + "temperatureHistory: [0.00, 20.30, 20.30, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 18.60, 20.40, 20.40, 20.40, 20.40,"
                            + " 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 20.40, 19.90, 20.40, 20.40, 20.40, 20.50, 20.50, 20.50,"
                            + " 20.50, 20.50, 20.50, 20.50, 20.50, 20.50, 20.50, 20.50, 20.50, 20.60, 20.60, 20.60, 20.60, 20.60, 20.60, 20.60, 20.60, 20.60, 20.70,"
                            + " 20.70, 20.70, 20.70, 20.70, 20.70, 20.80, 20.80, 20.80, 20.80, 20.80, 20.80, 20.80, 20.80, 20.90, 20.90, 20.90, 20.90, 20.90, 21.00, "
                            + "21.00, 21.00, 20.00, 21.00, 21.00, 21.00, 21.10, 21.10, 21.10, 21.10, 21.10, 21.20, 21.20, 21.20, 21.20, 21.20, 21.30, 21.30, 21.30, "
                            + "21.30, 21.30, 21.40, 21.40, 21.40, 21.40, 21.40, 21.50, 21.50, 21.50, 21.50, 21.50, 21.60, 21.60, 21.60, 21.60, 21.60, 20.30, 21.70, "
                            + "21.70, 21.70, 21.70, 21.70, 21.80, 21.80, 21.80, 21.80, 21.90, 21.90, 21.90, 21.90, 21.90, 22.00, 22.00, 22.00, 22.00, 22.00, 22.00, "
                            + "22.10, 22.10, 22.10, 22.10, 22.20, 22.20, 22.20, 22.20, 22.20, 21.00, 22.30, 22.30, 22.30, 22.30, 22.40, 22.40, 22.40, 22.40, 22.40, "
                            + "22.50, 22.50, 22.50, 22.50, 22.50, 22.60, 22.60, 22.60, 22.60, 22.60, 22.60, 22.70, 22.70, 22.70, 22.70, 22.80, 22.80, 22.80, 22.80, "
                            + "22.80, 22.80, 22.90, 22.90, 22.90, 22.90, 22.90, 23.00, 23.00, 23.00, 23.00, 23.00, 23.10, 23.10, 23.10, 23.10, 23.10, 23.10, 23.20, "
                            + "23.20, 23.20, 23.20, 23.20, 23.20, 23.30, 23.30, 23.30, 23.40, 23.40, 23.40, 23.40, 23.40, 23.40, 23.40, 23.50, 0.00, 0.00, 0.00, 0.00,"
                            + " 0.00, 23.60, 23.60, 23.60, 23.70, 23.70, 23.70, 23.70, 23.70, 23.70, 23.70, 23.70, 23.70, 22.60, 23.80, 23.80, 23.80, 23.90, 23.90, "
                            + "23.90, 23.90, 23.90, 23.90, 24.00, 24.00, 24.00, 24.00, 24.00, 24.00, 24.00, 23.80, 24.10, 24.00, 24.10, 24.10, 24.10, 24.20, 24.20, "
                            + "24.20, 24.20, 24.20, 24.20, 24.20, 24.30, 24.30, 24.30, 24.30, 24.30, 24.30, 24.40, 24.40, 24.40, 24.40, 24.40, 24.40, 24.40, 24.50, "
                            + "24.50, 24.50, 24.50, 24.50, 24.50, 24.50, 24.60, 24.60, 24.60, 24.60, 24.60, 24.60, 24.70, 24.70, 24.70, 24.70, 24.70, 24.70, 24.70, "
                            + "24.70, 23.60, 24.70, 24.80, 24.80, 24.80, 24.80, 24.80, 24.80, 24.90, 24.90, 24.90, 24.90, 24.90, 24.90, 24.90, 24.90, 25.00, 25.00, "
                            + "25.00, 25.00, 25.00, 25.10, 25.00, 25.10, 25.10, 25.10, 25.10, 25.10, 24.60, 25.10, 24.70, 25.10, 25.10, 25.20, 25.20, 25.20, 25.20, "
                            + "25.20, 25.20, 25.20, 25.30, 25.30, 25.30, 25.30, 25.30, 25.30, 25.30, 24.90, 25.30, 25.40, 25.30, 25.40, 25.40, 25.40, 25.00, 25.40, "
                            + "25.40, 25.40, 25.40, 25.50, 25.50, 25.50, 25.50, 25.50, 24.50, 25.50, 25.50, 25.50, 25.50, 25.50, 25.60, 25.60, 25.60, 25.60, 25.60, "
                            + "25.60, 25.60, 25.60, 25.60, 25.70, 25.70, 25.70, 25.70, 25.70, 25.70, 25.70, 25.70, 25.70, 25.80, 25.70, 25.80, 25.80, 25.80, 25.80, "
                            + "25.80, 25.80, 25.80, 25.80, 25.80, 25.80, 25.90, 25.90, 25.90, 25.90, 25.90, 25.90, 25.90, 25.90, 25.90, 25.90, 25.90, 25.30, 25.90, "
                            + "26.00, 26.00, 26.00, 26.00, 26.00, 26.00, 26.00, 26.00, 26.00, 26.00, 26.00, 26.00, 26.00, 26.10, 26.10, 25.80, 26.10, 26.10, 26.10, "
                            + "26.10, 26.10, 26.10, 26.10, 26.10, 26.10, 26.20, 26.20, 26.20, 26.20, 26.20, 26.20, 26.20, 26.20, 26.20, 26.20, 26.20, 26.20, 26.30, "
                            + "26.20, 26.30, 26.30, 26.30, 26.30, 26.30, 26.30, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, "
                            + "0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, "
                            + "0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, "
                            + "0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, ];"
                            + "dtHistory: [0, 140, 48, 63, 102, 141, 141, 141, 141, 137, 48, 56, 80, 104, 128, 141, 141, 141, 97, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 0, 0, 0, 0, 0, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, "
                            + "0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ];"
                            + "escHistory: [0, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 0, 0, 0, 0, 0, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, "
                            + "44, 44, 44, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, "
                            + "0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ]}";

                    final JSONObject jsonObject = new JSONObject(testJsonData);
                    myWebView.loadUrl("javascript:flightChart.data.datasets[0].data = " + jsonObject.get("altitudeHistory").toString() + ";");
                    myWebView.loadUrl("javascript:flightChart.data.datasets[1].data = " + jsonObject.get("temperatureHistory").toString() + ";");
                    myWebView.loadUrl("javascript:flightChart.update();");
                // end load json from the timer
            }
        });

        final FloatingActionButton flightGraphsButton = (FloatingActionButton) findViewById(R.id.flightGraphs);
        flightGraphsButton.setEnabled(false);
        flightGraphsButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                //myWebView.loadUrl("http://192.168.1.1/graph.json");
                myWebView.loadUrl("file:///android_asset/html/graphs.html");
                addFlightTest.setEnabled(true);
                Snackbar.make(view, "Flight Graphs", Snackbar.LENGTH_LONG).setAction("Action", null).show();
            }
        });
        connectionButton = (FloatingActionButton) findViewById(R.id.conectionInfo);
        connectionButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                WifiManager wifiManager = (WifiManager) getApplicationContext().getSystemService(Context.WIFI_SERVICE);
                WifiInfo wifiInfo = wifiManager.getConnectionInfo();
                String wifiMessage = "Connected to: " + wifiInfo.getSSID();
                if (wifiInfo.getSSID() == null || !wifiInfo.getSSID().equals("\"E36 Timer\"")) {
                    List<WifiConfiguration> wifiList = wifiManager.getConfiguredNetworks();
                    if (wifiList != null) {
                        for (WifiConfiguration wifiConfiguration : wifiList) {
                            wifiMessage += "\nScanned: " + wifiConfiguration.SSID;
                            if (wifiConfiguration.SSID != null && wifiConfiguration.SSID.equals("\"E36 Timer\"")) {
                                wifiManager.disconnect();
                                wifiManager.enableNetwork(wifiConfiguration.networkId, true);
                                wifiManager.reconnect();
                                wifiMessage += "\nReconnecting";
                                break;
                            }
                        }
                    }
                    //    myWebView.loadUrl("file:///android_asset/html/index.html");
                    //} else {
                    //myWebView.loadUrl("file:///android_asset/html/connected.html");
                    //    myWebView.loadUrl("http://192.168.1.1/graph.json");
                }
                flightGraphsButton.setEnabled(true);
                Snackbar.make(view, wifiMessage, Snackbar.LENGTH_LONG).setAction("Action", null).show();
            }
        });
        connectionCheckHandler.postDelayed(connectionCheckRunnable, 0);
    }

    @Override
    public void onResume() {
        super.onResume();
        connectionCheckHandler.postDelayed(connectionCheckRunnable, 0);
    }

    @Override
    public void onPause() {
        super.onPause();
        connectionCheckHandler.removeCallbacks(connectionCheckRunnable);
    }
}
